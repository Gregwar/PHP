TD6-2: Utilisation de Twig
===========================

.. |archive| image:: /img/archive.png

.. important::
    `|archive| Télécharger l'archive td6.zip </files/td6.zip>`_

Nous allons maintenant créer une structure de site web. Afin de ne pas perdre de temps à réaliser des
graphismes ou des feuilles de styles, une page d'exemple est fournie dans `td6 </files/td6.zip>`_, dans
le dossier ``design/``.

Installation de Twig
--------------------

.. step::


    Tout d'abord, nous allons ajouter Twig à notre projet Symfony::

        composer req twig

Rendu Twig depuis le contrôleur
-------------------------------

.. step::

    Les templates, ou "vues" de vote application se situent dans le dossier ``templates/``. Vous pouvez
    faire hériter votre contrôleur de ``Symfony\Bundle\FrameworkBundle\Controller\Controller`` de la
    façon suivante::

        use Symfony\Bundle\FrameworkBundle\Controller\Controller;

        class DefaultController extends Controller
        {
                //...

    Ainsi, votre contrôleur héritera d'un ensemble de fonction "raccourcie", comme ``render`` qui
    vous permet d'effectuer le rendu d'une vue Twig::

        public function indexAction()
        {
            return $this->render("default/index.html.twig");
        }

    Ainsi, si votre template est située dans ``templates/default/index.html.twig``, votre contrôleur
    rendra alors cette dernière.

.. step::

    Une petite astuce pour simplifeir le code est d'utiliser l'annotation ``@Template()``::

        composer req sensio/framework-extra-bundle

    Puis::

        use Sensio\Bundle\FrameworkExtraBundle\Configuration\Template;

        //...

        /**
         * @Route("/")
         * @Template()
         */
         public function indexAction()
         {
             return [];
         }

    Notez qu'ici:

    * Le nom du fichier ``default/index.html.twig`` est "deviné" automatiquement par l'annotation,
      car nous sommes dans le contrôleur ``DefaultController`` et sur la page ``indexAction``
    * La valeur retournée par la fonctione (``[]``) correspond aux paramètres de la vue

Création du layout
------------------

.. step::

    .. image:: /img/pizza.png
        :style: float:right

    Pour commencer, créez un layout principal ``layout.html.twig`` contenant la structure générale du
    site. Placez la feuille de style et les images dans le dossier ``public/`` de Symfony et utilisez la
    fonction ``asset()`` de Twig pour inclure ``style.css``. Pour ce faire, vous aurez besoin d'installer
    le composant ``asset``::

        composer req asset

    Toutes vos templates hériteront plus tard ce ce ``layout.html.twig`` et surchargeront certain
    de ses blocs.

    Vous pourrez par exemple placer un
    bloc ``contents`` à l'intérieur de votre page. Pour une documentation exhaustive, vous pouvez vous
    référer à la `documentation "Templating" <http://symfony.com/doc/current/book/templating.html>`_ de
    Symfony.

    Faites hériter la page ``default/index.html.twig`` de ``layout.html.twig``.

Une première page
-----------------

.. step::


    Maintenant que votre structure est en place, créez une nouvelle action pour lister les pizzas
    dans votre contrôleur. Bien entendu, nous n'allons pour le moment pas créer de base de
    données.
    Pour cela, vous pourrez ajouter une fonction de ce style avec ses annotations::

        <?php

            /**
             * @Route("/pizzas", name="pizzas_list")
             * @Template()
             */
            public function pizzasAction()
            {
                return [
                    'pizzas' => [
                        '4 fromages', 'Reine', 'Paysanne'
                    ]
                ];
            }

    Testez votre action en vous rendant à la page ``/pizzas`` de votre application, vous
    devriez voir un message d'erreur vous indicant que la template correspondante n'existe pas. Créez
    cette template en héritant du layout et surchargez le bloc du contenu pour afficher la liste des pizzas passées à la template.

.. vi fix: **
    
Création du premier lien
------------------------

.. step::

    Modifiez le lien du bouton "Les pizzas" de manière à ce qu'il pointe vers la page que vous venez
    de créer. Attention: ne mettez pas l'adresse de votre cible "en dur", mais utilisez la fonction twig
    ``path``:

    .. code-block:: django
        <a href="{{ path('pizzas_list') }}">Les pizzas</a>

Page d'accueil
--------------

.. step::

    Faites également pointer la page "Présentation" vers une second page que vous créerez, qui aura comme
    URL "/", ce sera la page d'accueil de votre site.
