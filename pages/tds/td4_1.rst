TD4-1: SQL et PDO
=================

.. image:: /img/db.png
    :class: right

.. |archive| image:: /img/archive.png

.. important::
    `|archive| Télécharger l'archive td4_1.zip </files/td4_2.zip>`_


.. step::

    Installation
    -----------

    Commencez par récupérer la base de données à partir de l'archive ci-dessus et par l'importer dans une base de données

Rappels SQL
-----------

Avant de commencer à utiliser le PDO avec PHP, nous allons effectuer des requêtes SQL "brutes" sur une base d'exemple.

Voici un diagramme représentant la base de données:

.. center::
    .. image:: /img/bdd_store.png

Elle contient les informations suivantes:

* ``categories`` les catégories de produits représentées par leur nom ``name``
* ``products`` les produits ayant un nom ``name``, un prix ``price`` et faisant partie d'une unique catégorie
* ``users`` les utilisateurs ayant un prénom ``firstname`` et un nom ``lastname``
* ``tickets`` qui correspond au passage en caisse d'un utilisateur à une ``date`` donnée
* ``tickets_entry`` faisant correspondre un ticket avec les produits et les quantités ``quantity`` achetés par le client

Dans cette partie, vous pourrez tester les requêtes dans **phpMyAdmin**. N'oubliez pas de les conserver dans des fichiers texte par exemple.

.. step::

    Récupération des produits et de leur catégorie
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    Ecrivez une requête permettant de récupérer l'ensemble des produits avec leur catégorie

.. step::

    Catégories et nombre de produits
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    Ecrivez une requête permettant de récupérer l'ensemble des catégories ainsi que le nombre de produits de cette catégorie

.. step::

    Affichage des tickets
    ~~~~~~~~~~~~~~~~~~~~~

    Affichez l'ensemble des tickets, comprenant le nom de l'utilisateur et le prix correspondant au ticket (la somme des prix des produits multipliés par la quantité sur le ticket)

.. step::

    Meilleurs clients
    ~~~~~~~~~~~~~~~~~

    Affichez l'ensemble des utilisateurs, et l'argent qu'ils ont dépensé en tout par ordre décroissant

.. step::

    Argent par jour
    ~~~~~~~~~~~~~~~

    Afficher l'ensemble des jours, et en face la somme d'argent encaissé à cette date


.. step::

    Achats spéciaux
    ~~~~~~~~~~~~~~~

    Ecrivez une requête qui retourne l'ensemble des utilisateurs n'ayant jamais acheté une machine à café

Utilisation du PDO
------------------

Coming soon